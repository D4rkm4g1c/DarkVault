<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DarkVault - API Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .api-section {
            margin-bottom: 2.5rem;
        }
        .endpoint {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #444;
        }
        .http-method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            min-width: 70px;
            text-align: center;
        }
        .method-get {
            background-color: #61affe;
        }
        .method-post {
            background-color: #49cc90;
        }
        .method-put {
            background-color: #fca130;
        }
        .method-delete {
            background-color: #f93e3e;
        }
        .url-path {
            font-family: monospace;
            background-color: #333;
            padding: 5px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }
        .code-block {
            background-color: #2a2a2a;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 15px 0;
        }
        .params-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .params-table th, .params-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        .params-table th {
            background-color: #333;
        }
        .security-warning {
            background-color: rgba(255, 87, 34, 0.1);
            border-left: 4px solid #ff5722;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <%- include('partials/navbar') %>

    <div class="container mt-4 mb-5">
        <h1>DarkVault API Documentation</h1>
        <div class="alert alert-warning mb-4">
            <strong><i class="bi bi-exclamation-triangle-fill me-2"></i>Note:</strong> 
            This API is intentionally designed with security vulnerabilities for educational purposes. 
            Do not use in production environments.
        </div>

        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h3 class="mb-0">Authentication</h3>
            </div>
            <div class="card-body">
                <p>Most API endpoints require authentication using a JWT token.</p>
                <p>To authenticate, include the JWT token in the Authorization header:</p>
                <div class="code-block">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</div>
                
                <h4>Getting a Token</h4>
                <p>You can obtain a token by logging in using the <code>/api/auth/login</code> endpoint.</p>
                
                <div class="security-warning">
                    <h5><i class="bi bi-shield-exclamation me-2"></i>Security Vulnerability:</h5>
                    <p>The JWT implementation has several weaknesses:</p>
                    <ul>
                        <li>Uses a weak secret key</li>
                        <li>No token expiration</li>
                        <li>No signature algorithm validation</li>
                        <li>JWT can be tampered with to escalate privileges</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Authentication Endpoints -->
        <div class="api-section">
            <h2>Authentication Endpoints</h2>

            <div class="endpoint">
                <h4>
                    <span class="http-method method-post">POST</span>
                    <span class="url-path">/api/auth/login</span>
                </h4>
                <p>Authenticate a user and obtain a JWT token.</p>
                
                <h5>Request Body:</h5>
                <div class="code-block">{
  "username": "string",
  "password": "string"
}</div>
                
                <h5>Response:</h5>
                <div class="code-block">{
  "token": "string",
  "user": {
    "id": "number",
    "username": "string",
    "isAdmin": "boolean",
    "role": "string"
  }
}</div>
            </div>

            <div class="endpoint">
                <h4>
                    <span class="http-method method-post">POST</span>
                    <span class="url-path">/api/auth/register</span>
                </h4>
                <p>Register a new user account.</p>
                
                <h5>Request Body:</h5>
                <div class="code-block">{
  "username": "string",
  "password": "string",
  "email": "string"
}</div>
                
                <h5>Response:</h5>
                <div class="code-block">{
  "token": "string",
  "user": {
    "id": "number",
    "username": "string",
    "isAdmin": "boolean",
    "role": "string"
  }
}</div>
            </div>
        </div>

        <!-- User Endpoints -->
        <div class="api-section">
            <h2>User Endpoints</h2>

            <div class="endpoint">
                <h4>
                    <span class="http-method method-get">GET</span>
                    <span class="url-path">/api/users</span>
                </h4>
                <p>Get a list of all users (authentication required).</p>
                
                <h5>Response:</h5>
                <div class="code-block">{
  "users": [
    {
      "id": "number",
      "username": "string",
      "email": "string",
      "isAdmin": "boolean"
    }
  ]
}</div>
                
                <div class="security-warning">
                    <h5><i class="bi bi-shield-exclamation me-2"></i>Security Vulnerability:</h5>
                    <p>This endpoint has an IDOR vulnerability - any authenticated user can view all users.</p>
                </div>
            </div>

            <div class="endpoint">
                <h4>
                    <span class="http-method method-get">GET</span>
                    <span class="url-path">/api/users/:id</span>
                </h4>
                <p>Get details for a specific user (authentication required).</p>
                
                <h5>URL Parameters:</h5>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>id</td>
                            <td>number</td>
                            <td>The user ID</td>
                        </tr>
                    </tbody>
                </table>
                
                <h5>Response:</h5>
                <div class="code-block">{
  "user": {
    "id": "number",
    "username": "string",
    "email": "string",
    "isAdmin": "boolean",
    "preferences": {}
  }
}</div>
                
                <div class="security-warning">
                    <h5><i class="bi bi-shield-exclamation me-2"></i>Security Vulnerability:</h5>
                    <p>This endpoint has an IDOR vulnerability - any authenticated user can view any other user's details.</p>
                    <p>Try accessing user ID 9999 for a hidden admin account.</p>
                </div>
            </div>

            <div class="endpoint">
                <h4>
                    <span class="http-method method-put">PUT</span>
                    <span class="url-path">/api/users/:id</span>
                </h4>
                <p>Update a user's information (authentication required).</p>
                
                <h5>URL Parameters:</h5>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>id</td>
                            <td>number</td>
                            <td>The user ID</td>
                        </tr>
                    </tbody>
                </table>
                
                <h5>Request Body:</h5>
                <div class="code-block">{
  "email": "string",
  "current_password": "string",
  "new_password": "string"
}</div>
                
                <h5>Response:</h5>
                <div class="code-block">{
  "message": "User updated successfully",
  "user": {
    "id": "number",
    "username": "string",
    "email": "string"
  }
}</div>
                
                <div class="security-warning">
                    <h5><i class="bi bi-shield-exclamation me-2"></i>Security Vulnerability:</h5>
                    <p>This endpoint is vulnerable to IDOR - it doesn't properly verify that users can only modify their own accounts.</p>
                </div>
            </div>
        </div>

        <!-- Message Endpoints -->
        <div class="api-section">
            <h2>Message Endpoints</h2>

            <div class="endpoint">
                <h4>
                    <span class="http-method method-get">GET</span>
                    <span class="url-path">/api/messages</span>
                </h4>
                <p>Get all messages (authentication required).</p>
                
                <h5>Response:</h5>
                <div class="code-block">{
  "messages": [
    {
      "id": "number",
      "user_id": "number",
      "content": "string",
      "title": "string",
      "author": "string",
      "timestamp": "string"
    }
  ]
}</div>
            </div>

            <div class="endpoint">
                <h4>
                    <span class="http-method method-post">POST</span>
                    <span class="url-path">/api/messages</span>
                </h4>
                <p>Create a new message (authentication required).</p>
                
                <h5>Request Body:</h5>
                <div class="code-block">{
  "title": "string",
  "content": "string", 
  "author": "string"
}</div>
                
                <h5>Response:</h5>
                <div class="code-block">{
  "message": "Message created successfully",
  "id": "number"
}</div>
                
                <div class="security-warning">
                    <h5><i class="bi bi-shield-exclamation me-2"></i>Security Vulnerability:</h5>
                    <p>This endpoint is vulnerable to XSS attacks because it doesn't sanitize the content.</p>
                </div>
            </div>
        </div>

        <!-- Admin Endpoints -->
        <div class="api-section">
            <h2>Admin Endpoints</h2>

            <div class="endpoint">
                <h4>
                    <span class="http-method method-get">GET</span>
                    <span class="url-path">/api/admin/logs</span>
                </h4>
                <p>Get system logs (admin authentication required).</p>
                
                <h5>Response:</h5>
                <div class="code-block">{
  "logs": [
    {
      "id": "number",
      "user_id": "number",
      "username": "string",
      "action": "string",
      "ip_address": "string",
      "created_at": "string",
      "user_agent": "string"
    }
  ]
}</div>
                
                <div class="security-warning">
                    <h5><i class="bi bi-shield-exclamation me-2"></i>Security Vulnerability:</h5>
                    <p>The admin check can be bypassed by adding <code>?admin=true</code> to the URL.</p>
                    <p>The log entries are vulnerable to Blind XSS because user input is rendered without sanitization.</p>
                </div>
            </div>
        </div>
    </div>

    <%- include('partials/footer') %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 