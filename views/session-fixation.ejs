<%- include('partials/header') %>

<div class="container mt-4">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card">
        <div class="card-header bg-danger text-white">
          <h4>Session Fixation Vulnerability Demo</h4>
        </div>
        <div class="card-body">
          <div class="alert alert-warning">
            <strong>Vulnerability Alert:</strong> This page demonstrates session fixation vulnerability. An attacker can:
            <ul>
              <li>Set a victim's session ID to a known value</li>
              <li>Wait for the victim to log in with that session ID</li>
              <li>Use the same session ID to hijack the victim's authenticated session</li>
            </ul>
          </div>
          
          <h5 class="mt-4">Current Session Information</h5>
          <div class="card mb-4">
            <div class="card-body">
              <p><strong>Your Session ID:</strong> <code id="session-id"><%= sessionId %></code></p>
              <p><strong>Authentication Status:</strong> <span class="badge badge-<%= user ? 'success' : 'danger' %>"><%= user ? 'Authenticated' : 'Not Authenticated' %></span></p>
              <% if (user) { %>
                <p><strong>Logged in as:</strong> <%= user.username %></p>
              <% } %>
            </div>
          </div>
          
          <h5>Change Session ID (Simulating Attack)</h5>
          <form id="fixation-form" class="mb-4">
            <div class="form-group">
              <label for="custom-session-id">Set Custom Session ID:</label>
              <div class="input-group">
                <input type="text" class="form-control" id="custom-session-id" placeholder="Enter custom session ID">
                <div class="input-group-append">
                  <button class="btn btn-primary" type="submit">Set Session ID</button>
                </div>
              </div>
              <small class="form-text text-muted">This simulates an attacker setting a known session ID.</small>
            </div>
          </form>
          
          <div class="mt-4">
            <h5>Exploitation Steps</h5>
            <ol>
              <li>Attacker generates a link with a known session ID and sends it to victim</li>
              <li>Victim clicks the link, which sets their session ID to the attacker's known value</li>
              <li>Victim logs in to the application (session ID is not regenerated)</li>
              <li>Attacker uses the same session ID to access the authenticated session</li>
            </ol>
            
            <div class="card bg-light mt-3">
              <div class="card-body">
                <h6>Attack URL Example:</h6>
                <code id="attack-url">http://localhost:3000/user/session-fixation?sessionId=<%= sessionId %></code>
                <button class="btn btn-sm btn-secondary mt-2" id="copy-url">Copy URL</button>
              </div>
            </div>
            
            <% if (!user) { %>
              <div class="mt-4">
                <a href="/login" class="btn btn-primary">Login with current session ID</a>
                <small class="form-text text-muted mt-1">In a secure application, the session ID would be regenerated after login.</small>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('fixation-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const sessionId = document.getElementById('custom-session-id').value.trim();
    if (sessionId) {
      window.location.href = `/user/session-fixation?sessionId=${encodeURIComponent(sessionId)}`;
    }
  });
  
  document.getElementById('copy-url').addEventListener('click', function() {
    const url = document.getElementById('attack-url').textContent;
    navigator.clipboard.writeText(url).then(function() {
      alert('Attack URL copied to clipboard!');
    });
  });
</script>

<%- include('partials/footer') %> 